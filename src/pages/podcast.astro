---
import Layout from "layouts/Layout.astro";
import { format } from "date-fns";
import { getCollection } from "astro:content";
import { sortPostByDate } from "helpers";
import { Image } from "astro:assets";
import spotifyBadge from "../assets/spotify-badge.svg";

const podcasts = await getCollection("podcast");

const sorted = podcasts.sort(sortPostByDate);
---

<Layout
  title="Podcast"
  description="Here is my blog. I started to write not so long ago and trying my best"
>
  <section class="prose max-w-full dark:prose-dark">
    <h1>Podcast</h1>
    <p>
      This is a collection of auto-generated podcast by different tools and
      techniques. The latest podcast has been generated with:
      <a href="https://notebooklm.google.com/">Notebook LLM</a>
    </p>

    <a href="https://open.spotify.com/show/7hba19unhTLNTFXnTf0T9T">
      <Image
        src={spotifyBadge}
        format="svg"
        alt="Spotify badge"
        loading="lazy"
        width={165}
        height={40}
        class="m-0"
      />
    </a>

    <ul class="list-none space-y-4 pl-0">
      {
        sorted.map((post) => (
          <li>
            <div class="flex justify-between items-baseline">
              <h3 class="truncate mt-3">{post.data.title}</h3>
              <span class="w-20 text-right">
                {format(post.data.publishedAt, "d MMM")}
              </span>
            </div>
            <p class="my-1 mb-3">{post.data.summary}</p>

            <audio controls>
              <source src={post.data.src} type="audio/wav" />
              Your browser does not support the audio element.
            </audio>
          </li>
        ))
      }
    </ul>
  </section>
</Layout>
