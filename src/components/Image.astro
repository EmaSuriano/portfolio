---
import {
  getImage,
  ImageMetadata,
  TransformOptions,
  OutputFormat,
} from '@astrojs/image';

interface LocalImageProps
  extends Omit<TransformOptions, 'src'>,
    Omit<astroHTML.JSX.ImgHTMLAttributes, 'src' | 'width' | 'height'> {
  src: ImageMetadata | Promise<{ default: ImageMetadata }>;
}

interface RemoteImageProps
  extends TransformOptions,
    astroHTML.JSX.ImgHTMLAttributes {
  src: string;
  width: number;
  height: number;
  format?: OutputFormat;
}

export type Props = LocalImageProps | RemoteImageProps;
const { src, ...rest } = Astro.props as Props;

const attrs = await getImage({ format: 'webp', src: `../src/${src}`, ...rest });
---

<img {...attrs} loading="lazy" decoding="async" />
